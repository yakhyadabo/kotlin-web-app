buildscript {
  ext.kotlin_version = '1.1.4'
  ext.junit_version = '4.11'
  ext.jooq_version = '3.10.2'

  repositories {
    mavenLocal()
    maven {
      url 'https://plugins.gradle.org/m2/'
    }
  }
  dependencies {
    classpath 'postgresql:postgresql:9.1-901.jdbc4'
  }
}

plugins {
  id 'nu.studer.jooq' version '2.0.9'
}

repositories {
  mavenLocal()
  mavenCentral()
}

dependencies {
  compile project(':kotlin-domain')

  compile "org.jooq:jooq:$jooq_version"
  compile "org.jooq:jooq-meta:$jooq_version"
  compile "org.jooq:jooq-codegen:$jooq_version"

  jooqRuntime 'postgresql:postgresql:9.1-901.jdbc4'

  testCompile  "junit:junit:$junit_version"
  testCompile "org.jetbrains.kotlin:kotlin-test-junit:$kotlin_version"
}

// apply plugin: 'nu.studer.jooq'

// See : https://github.com/etiennestuder/gradle-jooq-plugin

jooq {
  version = '3.10.2'
  edition = 'OSS'
  sample(sourceSets.main) {
    jdbc {
      driver = 'org.postgresql.Driver'
      url = 'jdbc:postgresql://localhost:5432/iris-db'
      user = 'iris-user'
      password = 'iris-password'
/*
      properties {
        property {
          key = 'ssl'
          value = 'true'
        }
      }
*/

    }
    generator {
      name = 'org.jooq.util.DefaultGenerator'
      strategy {
        name = 'org.jooq.util.DefaultGeneratorStrategy'
        // ...
      }
      database {
        name = 'org.jooq.util.postgres.PostgresDatabase'
        inputSchema = 'public'
        forcedTypes {
          forcedType {
            name = 'varchar'
            expression = '.*'
            types = 'JSONB?'
          }
          forcedType {
            name = 'varchar'
            expression = '.*'
            types = 'INET'
          }
        }
        // ...
      }
      generate {
        relations = true
        deprecated = false
        records = true
        immutablePojos = true
        fluentSetters = true
        // ...
      }
      target {
        packageName = 'org.yakhya.project.kotlin.repository'
        directory = 'src/main/generated'
      }
    }
  }
}
